<html>

<head>
  <!--Load the AJAX API-->
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    .Grade-Charts {
      text-align: center;
      font-family: Arial, Helvetica, sans-serif;
    }
  </style>
</head>

<body>
  <!--Div that will hold the pie chart-->
  <div class="Grade-Charts">
    <!-- <h1></h1> -->
    <div id="col_chart_html_tooltip"></div>
    <br />
    <button id="AExam">Exam A </button>
    <button id="BExam">Exam B </button>
    <button id="CExam">Exam C </button>
    <button id="AllExams"> All Exams </button>
  </div>



  <script type="text/javascript">
    google.charts.load('current', { 'packages': ['corechart'] });
    google.charts.setOnLoadCallback(drawChart);
    let AExam = [];
    let BExam = [];
    let CExam = [];
    let AllExams = [];
    let exam;

    function drawChart() {
      axios.get('/grades.csv')
        .then(res => {

          AllExams = csvJSON(res.data);
          AExam = AllExams.filter(data => {

            if (data.Exam === 'A') {
              return data;
            }
          })
          BExam = AllExams.filter(data => {

            if (data.Exam === 'B') {
              return data;
            }
          })
          CExam = AllExams.filter(data => {

            if (data.Exam === 'C') {
              return data;
            }
          })

          displayExam(AllExams);

        });

      // function that convert a csv file to an Object

      function csvJSON(csv) {

        let lines = csv.split("\r\n");
        // console.log(lines);
        let result = [];
        let keys = lines[0].split(",");
        // console.log(keys);
        for (let i = 0; i < lines.length; i++) {

          let obj = {};
          let currentValue = lines[i].split(",");
          console.log(currentValue);
          for (let j = 0; j < keys.length; j++) {
            obj[keys[j]] = currentValue[j];
            console.log(currentValue[j]);
          }
          result.push(obj);
        }

        return result.slice(1);
      };


      document.getElementById("AExam").addEventListener("click", function () { displayExam(AExam) });
      document.getElementById("BExam").addEventListener("click", function () { displayExam(BExam) });
      document.getElementById("CExam").addEventListener("click", function () { displayExam(CExam) });
      document.getElementById("AllExams").addEventListener("click", function () { displayExam(AllExams) });

      function displayExam(ExamtypeArray) {
        var dataTable = new google.visualization.DataTable();
        dataTable.addColumn('string', 'Grade');
        dataTable.addColumn('number', 'Sales');
        // A column for custom tooltip content
        dataTable.addColumn({ type: 'string', role: 'tooltip' });


        for (let i = 0; i < ExamtypeArray.length; i++) {
          let Grade = Number(ExamtypeArray[i].Grade);
          exam = Grade;

          dataTable.addRows(
            [
              [ExamtypeArray[i].Name, Grade, ExamtypeArray[i].Name + '-' + Grade + '-' + ExamtypeArray[i].Exam]
            ]);

        }
        console.log(exam);


        console.log(ExamtypeArray);

        var options = {

          title: 'Students Grades',
          colors: ['#e0440e'],
          is3D: true
        };

        function selectHandler(grade) {
            console.log(grade);
        }

        
        var chart = new google.visualization.ColumnChart(document.getElementById('col_chart_html_tooltip'));
        google.visualization.events.addListener(chart, 'select', function () {
          selectHandler(exam)
        });
        chart.draw(dataTable, options);
      };
    }





  </script>
  </head>